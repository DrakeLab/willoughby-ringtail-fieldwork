---
title: "Camera-Media-Status"
author: "Anna Willoughby"
date: "9/9/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyr)
library(dplyr)
library(here)
```

# Status of Canyon Critters Camera Media

Report date: `r Sys.Date()`

## Camera Method Summary

<!-- Should this be a separate paragraph/section from the one about maintenance? Or is this just a placeholder heading? -->

```{r data, include=FALSE, echo=FALSE}
days <- read.csv(here(file = "data/camera-data/camera_days.csv"))
events <- read.csv(here(file = "data/camera-data/check_event.csv"))
detection <- read.csv(here(file = "data/camera-data/detection_info.csv"))
sites <- read.csv(here(file = "data/camera-data/site_info.csv"))

deploy_date <- days %>%
  filter(days_since_deployment == 0) %>%
  select(site_id, date, trap_day) %>%
  arrange(date)
start_date <- deploy_date %>%
  filter(date == min(deploy_date$date)) %>% select(date)

site_list <- sites %>% 
  filter(SiteNumber != "PilotSite") %>%
  filter (SiteNumber != "DuplicateSite") %>%
  select(SiteID, SiteType)
count_natural <- site_list %>%
  filter(SiteType == "outdoor")
prop_natural <- round(nrow(count_natural)/nrow(site_list)*100)
count_building <- site_list %>%
  filter(SiteType == "building")
prop_building <- round(nrow(count_building)/nrow(site_list)*100)

days_count <- days %>%
  filter(status != "Not Yet Deployed")

days_functional <- days_count %>%
  filter(status == "Functional")
prop_functional <- round(nrow(days_functional)/nrow(days_count)*100,1)

days_sd_full <- days_count %>%
  filter(status == "Card Full")
prop_sd_full <- round(nrow(days_sd_full)/nrow(days_count)*100,1)

days_batteries_dead <- days_count %>%
  filter(status == "Batteries Dead")
prop_batteries_dead <- round(nrow(days_batteries_dead)/nrow(days_count)*100)

days_dislodged <- days_count %>%
  filter(status == "Camera Dislodged")
prop_dislodged <- round(nrow(days_dislodged)/nrow(days_count)*100,1)

# mean_event_duration <- events %>%
  # mean(Event_Duration_Days)
  # event duration isn't filled out for these yet, so the function doesn't have any numbers to draw on until that's updated

count_triggers_total <- sum(events$n_TriggerEvents, na.rm = TRUE)

backup <- events %>%
  filter(In_Two_Locations == "Yes") %>%
  nrow()
count_events <- nrow(events)
prop_backup <- round(backup/count_events*100,1)

upload <- events %>%
  filter(Uploaded_Zooniverse == "Yes") %>%
  nrow()
prop_upload <- round(upload/count_events*100,1)

```

## Study Design and Maintenance

From `r start_date`, cameras were deployed at `r nrow(site_list)` sites for a total of `r nrow(days_count)` camera days. `r nrow(count_natural)` (`r prop_natural`%) cameras are located at natural sites and `r nrow(count_building)` (`r prop_building`%) are located at building sites. The cameras were functional for `r nrow(days_functional)` days, `r prop_functional`% of the study period. Camera function was interrupted when a camera had a full SD card (`r nrow(days_sd_full)` days [`r prop_sd_full`%]), a dead battery (`r nrow(days_batteries_dead)` days [`r prop_batteries_dead`%]), or was dislodged or misplaced (`r nrow(days_dislodged)` days [`r prop_dislodged`%]).

Camera data is collected periodically in check events. Across all sites, camera data has been collected `r nrow(events)` times. Each check event covers an average of NUMBER camera days, with an average of NUMBER (PERCENT) functional camera days.

Across all sites, cameras captured `r count_triggers_total` trigger events, of which NUMBER (PERCENT) were animal detections. Cameras deployed at natural sites recorded two photographs per trigger event. In total, natural sites captured NUMBER trigger events, covering DURATION. Cameras deployed at building sites recorded videos in 20, 30, or 60-second durations. In total, building sites captured NUMBER trigger events, covering DURATION.

```{r maintenancegraphs, include=TRUE}
# graphs
# deployment date graph -- pivot the dates
deployment_data <- days %>%
  filter(days_since_deployment != "???") %>% filter(days_since_deployment != "n/a") %>%
  select(site_id, date, trap_day) %>%
  arrange(date) %>%
  pivot_wider(names_from = date, values_from = trap_day)
```

## Data Storage and Status

Camera data is stored by check event. Of the `r nrow(events)` check events, `r backup` (`r prop_backup`%) are stored in two physical locations. `r upload` (`r prop_upload`%) are uploaded to the Canyon Critters Zooniverse project.
