---
title: "Camera-Media-Status"
author: "Anna Willoughby"
date: Sys.Date()
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# data wrangling
library(tidyr)
library(dplyr)
# plotting package 
library(ggplot2)

# multiple machine compatibility
library(here)

# date formatting
library(lubridate)

# load in datasets 
trapdays <- read.csv(here(file = "data/camera-data/camera_days.csv")) # trap days and status 
events <- read.csv(here(file = "data/camera-data/check_event.csv")) # check events
detection <- read.csv(here(file = "data/camera-data/detection_info.csv")) # camera triggers
sites <- read.csv(here(file = "data/camera-data/site_info.csv")) # site information
```

# Status of Canyon Critters Camera Media

Report date: `r Sys.Date()`

## Camera Method Summary

Camera traps deployed at natural (outdoor) and building (indoor) sites in Grand Canyon and Zion National Parks capture animal activity by recording images or videos of detected movement. Camera data is collected seasonally, on average every 3 months. Collected data is organized and formatted for upload to Zooniverse, where citizen science volunteers help to identify animals recorded by the cameras.

Sites are the locations where cameras are deployed alongside a tunnel containing bait and hair and paw print collection materials. Sites are either natural sites located in outdoor locations in the parks, or building sites located in areas of park buildings such as crawlspaces and attics. Each site has a unique alphanumeric ID.

Camera check events are the events when sites are checked. Camera data is collected and fresh SD cards and batteries are installed. Camera checks are named for the date the data is collected, which is the final day of that check event. Camera checks are named with the site ID, "CC" for camera check, and the date of collection. Check event duration is measured in days.

Study days are the dates during which cameras generally are collecting data. Camera days are the dates during which an individual camera is collecting data, and consist of a study day combined with a site ID. 

## Study Design and Maintenance

```{r data, include=FALSE, echo=FALSE}

# transform trap days into actual functional days of study. 
study_days <- trapdays %>% 
  filter(status != "Not Yet Deployed") %>%
  group_by(date) %>% 
  summarise(n_cameras_deployed = n_distinct(site_id)) # calculate # of cameras deployed per day 
            # add functional trap days per actual day 

# filter trap days to functional days only
functional_trap_days <- trapdays %>% 
  filter(status == "Functional") %>%
  group_by(date) %>%
  summarise(n_cameras_deployed = n_distinct(site_id)) # calculate # of cameras functional per day

# Find date of deployment for each camera site
deploy_date <- trapdays %>%
  filter(days_since_deployment == 0) %>%
  select(site_id, date, trap_day) %>%
  arrange(date)

# Select earliest date of deployment as study start date
start_date <- deploy_date %>%
  filter(date == min(deploy_date$date)) %>% select(date)

# List study sites
site_list <- sites %>% 
  filter(SiteNumber != "PilotSite") %>%
  filter (SiteNumber != "DuplicateSite") %>%
  select(SiteID, SiteType)

# Count sites by type and calculate proportion of all sites of each type
count_natural <- site_list %>%
  filter(SiteType == "outdoor")
prop_natural <- round(nrow(count_natural)/nrow(site_list)*100)
count_building <- site_list %>%
  filter(SiteType == "building")
prop_building <- round(nrow(count_building)/nrow(site_list)*100)

# Count number of trap days in study
camera_days_count <- trapdays %>%
  filter(status != "Not Yet Deployed")

# Calculate number of functional trap days
site_days_functional <- camera_days_count %>%
  filter(status == "Functional")
prop_functional <- round(nrow(site_days_functional)/nrow(camera_days_count)*100,1)

# Calculate number of trap days where SD card was full
site_days_sd_full <- camera_days_count %>%
  filter(status == "Card Full")
prop_sd_full <- round(nrow(site_days_sd_full)/nrow(camera_days_count)*100,1)

# Calculate number of trap days where batteries were dead
site_days_batteries_dead <- camera_days_count %>%
  filter(status == "Batteries Dead")
prop_batteries_dead <- round(nrow(site_days_batteries_dead)/nrow(camera_days_count)*100)

# Calculate number of trap days where camera was dislodged
site_days_dislodged <- camera_days_count %>%
  filter(status == "Camera Dislodged")
prop_dislodged <- round(nrow(site_days_dislodged)/nrow(camera_days_count)*100,1)

# Calculate average check event duration
mean_event_duration <- mean(events$Event_Duration_Days, na.rm = TRUE)

# Count number of trigger events across all sites and dates
count_triggers_total <- sum(events$n_TriggerEvents, na.rm = TRUE)

#Calculate proportion of animal detections
count_detections <- detection %>%
  filter(species_detected != "false_trigger") %>%
  filter(!is.na(species_detected)) %>%
  nrow()
prop_detections <- round(count_detections/count_triggers_total*100)

```

In the study design, indoor sites are generally set to record XX-second videos and outdoor sites are generally set to record two photos in succession.

From `r start_date`, cameras were deployed at `r nrow(site_list)` sites over `r nrow(study_days)` days, for a total of `r nrow(camera_days_count)` camera days. `r nrow(count_natural)` (`r prop_natural`%) cameras are located at natural sites and `r nrow(count_building)` (`r prop_building`%) are located at building sites. The cameras were functional for `r nrow(site_days_functional)` camera days, `r prop_functional`% of the study period. Camera function was interrupted when a camera had a full SD card (`r nrow(site_days_sd_full)` camera days [`r prop_sd_full`%]), a dead battery (`r nrow(site_days_batteries_dead)` camera days [`r prop_batteries_dead`%]), or was dislodged or misplaced (`r nrow(site_days_dislodged)` camera days [`r prop_dislodged`%]).

Camera data is collected seasonally, on average every 3 months. Across all sites, camera data has been collected `r nrow(events)` times. Each check event covers an average of `r mean_event_duration` camera days, with an average of NUMBER (PERCENT) functional camera days.

```{r maintenancegraphs, include=TRUE, echo=FALSE}

# Plot out relationship between date and functionality 
study_period_plot <- ggplot(study_days) +
  geom_col(aes(x = lubridate::ymd(date), y = n_cameras_deployed)) +
  scale_x_date(date_breaks = "1 month") +
  labs(x = "Date", y = "Number of cameras deployed") +
  theme(axis.text.x = element_text(angle=45))
study_period_plot

```

## Data Storage and Status
``` {r storage, include=FALSE, echo=FALSE}

# Calculate number of events that are backed up to 2 physical locations
backup <- events %>%
  filter(In_Two_Locations == "Yes") %>%
  nrow()
count_events <- nrow(events)
prop_backup <- round(backup/count_events*100,1)

# Calculate number of events that are uploaded to Zooniverse
upload_zooniverse <- events %>%
  filter(Uploaded_Zooniverse != "No")
upload_zooniverse_count <- nrow(upload_zooniverse)
prop_upload <- round(upload_zooniverse_count/count_events*100,1)

```
Camera data is stored by check event. Of the `r nrow(events)` check events, `r backup` (`r prop_backup`%) are stored in two physical locations. `r upload_zooniverse_count` (`r prop_upload`%) are uploaded to the Canyon Critters Zooniverse project.

``` {r storagegraphs, include = TRUE, echo = FALSE}

# plot uploads to Zooniverse against date
upload_zooniverse_plot <- ggplot(upload_zooniverse) +
  geom_col(aes(x = lubridate::ymd(date), y = Uploaded_Zooniverse)) +
  scale_x_date(date_breaks = "1 month") +
  labs(x = "Date", y = "Check events uploaded to Zooniverse") +
  theme(axis.text.x = element_text(angle=45))
upload_zooniverse_plot 

```

## Preliminary Analysis

depends on data storage and status

Across all sites, cameras captured `r count_triggers_total` trigger events, of which `r count_detections` (`r prop_detections`%) were animal detections. Cameras deployed at natural sites recorded two photographs per trigger event. In total, natural sites captured NUMBER trigger events, covering DURATION. Cameras deployed at building sites recorded videos in 20, 30, or 60-second durations. In total, building sites captured NUMBER trigger events, covering DURATION.
